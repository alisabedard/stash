#!/bin/sh

# Stash (C) 2015-2020 Jeffrey E. Bedard
# Very simple symlink-based package manager

# Set to your desired package location. Install packages in individual
# prefixes within this directory.
# Configure example for gettext:
# ./configure --prefix=/opt/gettext-0.20.1; make; make install
STASHDIR=/opt
# Set this to the destination directory where symlinks should be made.
PREFIX=/usr/local
get_items()
{
    find . | cut -d. -f2- | cut -d/ -f2-
}
uninstall()
{
    cd $STASHDIR/$1
    CONTENTS=`mktemp`
    get_items > $CONTENTS
    cd $PREFIX
    xargs -a $CONTENTS rm -f 2> /dev/null
    cat $CONTENTS
    rm $CONTENTS
}
if [ ! "$1" ]; then # list available stash packages
    ls $STASHDIR
elif [ "$1" = "-a" ]; then # stash all
    for DIR in $STASHDIR; do
        stash $DIR
    done
elif [ "$1" = "-r" ]; then # remove
    uninstall $2
else # install
    stash -r $1
    cd $STASHDIR/$1
    for I in `get_items`; do
        if [ -d "$I" ]; then
            mkdir -p $PREFIX/$I
        else
            ln -s $STASHDIR/$1/$I $PREFIX/$I
        fi
    done
fi
